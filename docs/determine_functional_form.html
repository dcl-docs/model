<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Determine functional form | Data Modeling</title>
  <meta name="description" content="This book is a practical introduction to modeling using the tidyverse." />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Determine functional form | Data Modeling" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This book is a practical introduction to modeling using the tidyverse." />
  <meta name="github-repo" content="dcl-docs/model" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Determine functional form | Data Modeling" />
  
  <meta name="twitter:description" content="This book is a practical introduction to modeling using the tidyverse." />
  

<meta name="author" content="Sara Altman, Bill Behrman" />


<meta name="date" content="2022-04-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="understand_your_data.html"/>
<link rel="next" href="fitting_basics.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Modeling</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-read-this-book"><i class="fa fa-check"></i>How to read this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#an-evolving-book"><i class="fa fa-check"></i>An evolving book</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="model_basics.html"><a href="model_basics.html"><i class="fa fa-check"></i><b>1</b> Model basics</a>
<ul>
<li class="chapter" data-level="1.1" data-path="model_basics.html"><a href="model_basics.html#what-is-a-model"><i class="fa fa-check"></i><b>1.1</b> What is a model?</a></li>
<li class="chapter" data-level="1.2" data-path="model_basics.html"><a href="model_basics.html#supervised-learning"><i class="fa fa-check"></i><b>1.2</b> Supervised learning</a></li>
<li class="chapter" data-level="1.3" data-path="model_basics.html"><a href="model_basics.html#choosing-a-function-family"><i class="fa fa-check"></i><b>1.3</b> Choosing a function family</a></li>
<li class="chapter" data-level="1.4" data-path="model_basics.html"><a href="model_basics.html#classical-modeling"><i class="fa fa-check"></i><b>1.4</b> Classical modeling</a></li>
<li class="chapter" data-level="1.5" data-path="model_basics.html"><a href="model_basics.html#bayesian-modeling"><i class="fa fa-check"></i><b>1.5</b> Bayesian modeling</a></li>
<li class="chapter" data-level="1.6" data-path="model_basics.html"><a href="model_basics.html#summary"><i class="fa fa-check"></i><b>1.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="understand_your_data.html"><a href="understand_your_data.html"><i class="fa fa-check"></i><b>2</b> Understand your data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="understand_your_data.html"><a href="understand_your_data.html#understand-your-variables"><i class="fa fa-check"></i><b>2.1</b> Understand your variables</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="understand_your_data.html"><a href="understand_your_data.html#read-the-documentation"><i class="fa fa-check"></i><b>2.1.1</b> Read the documentation</a></li>
<li class="chapter" data-level="2.1.2" data-path="understand_your_data.html"><a href="understand_your_data.html#glimpse"><i class="fa fa-check"></i><b>2.1.2</b> <code>glimpse()</code></a></li>
<li class="chapter" data-level="2.1.3" data-path="understand_your_data.html"><a href="understand_your_data.html#summary-1"><i class="fa fa-check"></i><b>2.1.3</b> <code>summary()</code></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="understand_your_data.html"><a href="understand_your_data.html#check-for-problems"><i class="fa fa-check"></i><b>2.2</b> Check for problems</a></li>
<li class="chapter" data-level="2.3" data-path="understand_your_data.html"><a href="understand_your_data.html#d-eda"><i class="fa fa-check"></i><b>2.3</b> 1D EDA</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="understand_your_data.html"><a href="understand_your_data.html#variable-types"><i class="fa fa-check"></i><b>2.3.1</b> Variable types</a></li>
<li class="chapter" data-level="2.3.2" data-path="understand_your_data.html"><a href="understand_your_data.html#continuous-variables"><i class="fa fa-check"></i><b>2.3.2</b> Continuous variables</a></li>
<li class="chapter" data-level="2.3.3" data-path="understand_your_data.html"><a href="understand_your_data.html#discrete-variables"><i class="fa fa-check"></i><b>2.3.3</b> Discrete variables</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="understand_your_data.html"><a href="understand_your_data.html#summary-2"><i class="fa fa-check"></i><b>2.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="determine_functional_form.html"><a href="determine_functional_form.html"><i class="fa fa-check"></i><b>3</b> Determine functional form</a>
<ul>
<li class="chapter" data-level="3.1" data-path="determine_functional_form.html"><a href="determine_functional_form.html#formulas"><i class="fa fa-check"></i><b>3.1</b> Formulas</a></li>
<li class="chapter" data-level="3.2" data-path="determine_functional_form.html"><a href="determine_functional_form.html#continuous-predictors"><i class="fa fa-check"></i><b>3.2</b> Continuous predictors</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="determine_functional_form.html"><a href="determine_functional_form.html#transformations"><i class="fa fa-check"></i><b>3.2.1</b> Transformations</a></li>
<li class="chapter" data-level="3.2.2" data-path="determine_functional_form.html"><a href="determine_functional_form.html#visual-checks"><i class="fa fa-check"></i><b>3.2.2</b> Visual checks</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="determine_functional_form.html"><a href="determine_functional_form.html#discrete-predictors"><i class="fa fa-check"></i><b>3.3</b> Discrete predictors</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="determine_functional_form.html"><a href="determine_functional_form.html#functional-form"><i class="fa fa-check"></i><b>3.3.1</b> Functional form</a></li>
<li class="chapter" data-level="3.3.2" data-path="determine_functional_form.html"><a href="determine_functional_form.html#visual-checks-1"><i class="fa fa-check"></i><b>3.3.2</b> Visual checks</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="determine_functional_form.html"><a href="determine_functional_form.html#summary-3"><i class="fa fa-check"></i><b>3.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="fitting_basics.html"><a href="fitting_basics.html"><i class="fa fa-check"></i><b>4</b> Fitting basics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="fitting_basics.html"><a href="fitting_basics.html#fitting-a-model"><i class="fa fa-check"></i><b>4.1</b> Fitting a model</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="fitting_basics.html"><a href="fitting_basics.html#fitting-a-classical-model"><i class="fa fa-check"></i><b>4.1.1</b> Fitting a classical model</a></li>
<li class="chapter" data-level="4.1.2" data-path="fitting_basics.html"><a href="fitting_basics.html#fitting-a-bayesian-model"><i class="fa fa-check"></i><b>4.1.2</b> Fitting a Bayesian model</a></li>
<li class="chapter" data-level="4.1.3" data-path="fitting_basics.html"><a href="fitting_basics.html#tidymodels"><i class="fa fa-check"></i><b>4.1.3</b> Tidymodels</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="fitting_basics.html"><a href="fitting_basics.html#checking-a-model"><i class="fa fa-check"></i><b>4.2</b> Checking a model</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="fitting_basics.html"><a href="fitting_basics.html#making-predictions"><i class="fa fa-check"></i><b>4.2.1</b> Making predictions</a></li>
<li class="chapter" data-level="4.2.2" data-path="fitting_basics.html"><a href="fitting_basics.html#checking-predictions"><i class="fa fa-check"></i><b>4.2.2</b> Checking predictions</a></li>
<li class="chapter" data-level="4.2.3" data-path="fitting_basics.html"><a href="fitting_basics.html#checking-residuals"><i class="fa fa-check"></i><b>4.2.3</b> Checking residuals</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="fitting_basics.html"><a href="fitting_basics.html#summary-4"><i class="fa fa-check"></i><b>4.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="model_evaluation.html"><a href="model_evaluation.html"><i class="fa fa-check"></i><b>5</b> Model evaluation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="model_evaluation.html"><a href="model_evaluation.html#model-overfitting"><i class="fa fa-check"></i><b>5.1</b> Model overfitting</a></li>
<li class="chapter" data-level="5.2" data-path="model_evaluation.html"><a href="model_evaluation.html#model-selection"><i class="fa fa-check"></i><b>5.2</b> Model selection</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="model_evaluation.html"><a href="model_evaluation.html#classical-modeling-1"><i class="fa fa-check"></i><b>5.2.1</b> Classical modeling</a></li>
<li class="chapter" data-level="5.2.2" data-path="model_evaluation.html"><a href="model_evaluation.html#bayesian-modeling-1"><i class="fa fa-check"></i><b>5.2.2</b> Bayesian modeling</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="model_evaluation.html"><a href="model_evaluation.html#final-model"><i class="fa fa-check"></i><b>5.3</b> Final model</a></li>
<li class="chapter" data-level="5.4" data-path="model_evaluation.html"><a href="model_evaluation.html#summary-5"><i class="fa fa-check"></i><b>5.4</b> Summary</a></li>
<li class="chapter" data-level="5.5" data-path="model_evaluation.html"><a href="model_evaluation.html#to-learn-more"><i class="fa fa-check"></i><b>5.5</b> To learn more</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Modeling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="determine-functional-form" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Determine functional form<a href="determine_functional_form.html#determine-functional-form" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="determine_functional_form.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p>In Chapter 1, we mentioned that a first step to building a model is to explore your data and choose an appropriate function family. This chapter focuses on this step. Using <code>diamonds</code>, we’ll explore the relationship between <code>price</code> and the four Cs: <code>carat</code>, <code>clarity</code>, <code>color</code>, and <code>cut</code>. By the end of the chapter, we’ll understand which function family or families might approximate this data well.</p>
<div id="formulas" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Formulas<a href="determine_functional_form.html#formulas" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In Chapter 1, we mentioned that the modeling function <code>lm()</code> requires two arguments: a function family and data. With <code>lm()</code>, like many modeling functions, you specify the function family using a <em>formula</em>.</p>
<p>Our model from Chapter 1 belonged to the family with the form</p>
<p><code>y = a_0 + a_1 * x_1</code></p>
<p>where <code>y</code> is the response, <code>x_1</code> is a continuous variable, and <code>a_0</code> and <code>a_1</code> are parameters to be determined. Recall that <code>a_0</code> is the intercept and <code>a_1</code> is the slope.</p>
<p>This function family is specified with the formula</p>
<p><code>y ~ x_1</code> .</p>
<p>You place the name of the response variable to the left of the <code>~</code> and the predictor variable(s) to the right of the <code>~</code>. The general form for the formula of a linear function of n variables is</p>
<p><code>y ~ x_1 + x_2 + ... + x_n</code> .</p>
<p>Formulas are their own class of R object, and you specify them unquoted.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="determine_functional_form.html#cb27-1" aria-hidden="true" tabindex="-1"></a>y <span class="sc">~</span> x_1</span>
<span id="cb27-2"><a href="determine_functional_form.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; y ~ x_1</span></span>
<span id="cb27-3"><a href="determine_functional_form.html#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(y <span class="sc">~</span> x_1)</span>
<span id="cb27-4"><a href="determine_functional_form.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;formula&quot;</span></span></code></pre></div>
<p>You don’t need to explicitly specify an intercept term as it will be included by default. If you don’t want an intercept term, add a <code>0</code> to your formula.</p>
<p><code>y ~ 0 + x_1</code></p>
<p>We’ll now see how to explore and understand the suitability of modeling your data with linear functions.</p>
</div>
<div id="continuous-predictors" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Continuous predictors<a href="determine_functional_form.html#continuous-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s start with continuous predictors, as they should be familiar after reading Chapter 1.</p>
<p>In Chapter 2, we modified <code>diamonds</code> quite a bit. Here are all of those modifications in one place:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="determine_functional_form.html#cb28-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> </span>
<span id="cb28-2"><a href="determine_functional_form.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  diamonds <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="determine_functional_form.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>, y <span class="sc">&gt;</span> <span class="dv">0</span>, z <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="determine_functional_form.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(y <span class="sc">&lt;</span> <span class="dv">20</span>, z <span class="sc">&lt;</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="determine_functional_form.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(carat <span class="sc">&lt;=</span> <span class="fu">quantile</span>(.<span class="sc">$</span>carat, <span class="at">probs =</span> <span class="fl">0.99</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="determine_functional_form.html#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">fct_rev</span>(color))</span></code></pre></div>
<p>Now, we can visualize the relationship between <code>carat</code> and <code>price</code> and look for a linear relationship.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="determine_functional_form.html#cb29-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="determine_functional_form.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(carat, price)) <span class="sc">+</span></span>
<span id="cb29-3"><a href="determine_functional_form.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.01</span>)</span></code></pre></div>
<p><img src="determine_functional_form_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The larger diamonds cover a wide range of prices, so we’ll add a smooth line to show the central tendency.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="determine_functional_form.html#cb30-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="determine_functional_form.html#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(carat, price)) <span class="sc">+</span></span>
<span id="cb30-3"><a href="determine_functional_form.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb30-4"><a href="determine_functional_form.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code></pre></div>
<p><img src="determine_functional_form_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Notice how <code>price</code>, especially for the larger diamonds, varies substantially among diamonds of the same size. This variation suggests that <code>carat</code> is not the only variable that influences <code>price</code>. From the smooth line, we can also see that the relationship between <code>carat</code> and <code>price</code> is positive, but not linear. Luckily, we can still use a linear model by first transforming the data. We’ll talk more about transformations next.</p>
<div id="transformations" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Transformations<a href="determine_functional_form.html#transformations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>Power law</em> relationships take the form</p>
<p><code>y = c * x^d</code></p>
<p>where <code>c</code> and <code>d</code> are both constants. Taking the log of both sides gives us</p>
<p><code>log(y) = log(c) + d * log(x)</code></p>
<p>which might look familiar. Power laws are linear in terms of <code>log(y)</code> and <code>log(x)</code>, which is even clearer if we replace <code>log(c)</code> with <code>a_0</code> and <code>d</code> with <code>a_1</code>.</p>
<p><code>log(y) = a_0 + a_1 * log(x)</code></p>
<p>Phenomena that follow power laws are common. You can determine if your data approximately follow a power law by plotting your data using log scales for the x and y axes and then visually checking if the relationship is linear.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="determine_functional_form.html#cb31-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="determine_functional_form.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(carat, price)) <span class="sc">+</span></span>
<span id="cb31-3"><a href="determine_functional_form.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb31-4"><a href="determine_functional_form.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb31-5"><a href="determine_functional_form.html#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb31-6"><a href="determine_functional_form.html#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()</span></code></pre></div>
<p><img src="determine_functional_form_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The smooth line is now linear, suggesting that the functional form <code>log(price) = a_0 + a_1 * log(carat)</code> will approximate the relationship between <code>price</code> and <code>carat</code> well.</p>
<p>To specify this function family in a formula, we can apply the <code>log()</code> transformations in the formula:</p>
<p><code>log(price) ~ log(carat)</code> .</p>
<p>Log-log transformations are common, but you can apply any transformation (to your response, predictor, or both) that makes your data linear.</p>
<p>You might wonder why you should bother transforming your data instead of just fitting a nonlinear model. Linear models are generally simpler, easier to interpret, and often produce better approximations.</p>
</div>
<div id="visual-checks" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Visual checks<a href="determine_functional_form.html#visual-checks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>carat</code> is the only continuous variable of the four Cs, but other datasets will have multiple possible continuous predictors. Here are two features to check for when considering adding a continuous predictor to your model.</p>
<p>First, as you’ve already seen, the relationship between the predictor and the response should be linear. If necessary, transform the data so that the relationship is linear. If the relationship is nonlinear and you can’t find a transformation that makes it linear, don’t add the predictor to your linear model.</p>
<p>Second, the predictor should influence the response. In our visualization of <code>price</code> and <code>carat</code>, we noticed that <code>price</code> increased as <code>carat</code> increased. If the predictor does not influence the response, you might see something like this:</p>
<p><img src="determine_functional_form_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The smooth line is horizontal, which tells you that <code>y</code> does not change with <code>x</code>.</p>
<p>The <code>diamonds</code> data is relatively simple, and we’ve made it even simpler by restricting attention to the four Cs. When you have more variables, you’ll need to conduct more preprocessing and pay more attention to which variables to include and which to exclude. If you’d like to learn more, a good resource is Kuhn and Johnson, <a href="https://bookdown.org/max/FES/">Feature Engineering and Selection</a>, particularly the <a href="https://bookdown.org/max/FES/stroke-preprocessing.html">Preprocessing</a> section.</p>
</div>
</div>
<div id="discrete-predictors" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Discrete predictors<a href="determine_functional_form.html#discrete-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Earlier, we noticed that <code>price</code> varies substantially for diamonds of a given <code>carat</code>. In this section, we’ll investigate how the three discrete Cs, <code>clarity</code>, <code>color</code>, and <code>cut</code>, influence price.</p>
<div id="functional-form" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Functional form<a href="determine_functional_form.html#functional-form" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Discrete predictors work differently than continuous predictors. When a linear model includes a discrete predictor, a different constant will be added for each value of the variable.</p>
<p>We’ll visualize the effect of <code>cut</code> by adding a smooth line for each value to our plot of <code>price</code> vs. <code>carat</code>. We’ll leave off the individual points to focus on the trends.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="determine_functional_form.html#cb32-1" aria-hidden="true" tabindex="-1"></a>plot_smooth <span class="ot">&lt;-</span> <span class="cf">function</span>(var, <span class="at">data =</span> df) {</span>
<span id="cb32-2"><a href="determine_functional_form.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="determine_functional_form.html#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(carat, price, <span class="at">color =</span> {{ var }})) <span class="sc">+</span></span>
<span id="cb32-4"><a href="determine_functional_form.html#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="at">formula =</span> y <span class="sc">~</span> x) <span class="sc">+</span></span>
<span id="cb32-5"><a href="determine_functional_form.html#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb32-6"><a href="determine_functional_form.html#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb32-7"><a href="determine_functional_form.html#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span>
<span id="cb32-8"><a href="determine_functional_form.html#cb32-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-9"><a href="determine_functional_form.html#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="determine_functional_form.html#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_smooth</span>(cut)</span></code></pre></div>
<p><img src="determine_functional_form_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The smooth lines look linear, and all appear to have similar slopes but different intercepts, which increase as <code>cut</code> quality increases. This suggests that the following functional form, in which the intercept of the line depends on <code>cut</code>, would approximate our data well.</p>
<p><code>log(price) = a_0 + a_1 * log(carat) + f_cut(cut)</code></p>
<p>We need <code>f_cut()</code> to return a different constant for each value of <code>cut</code>. We can write <code>f_cut()</code> in R using <code>case_when()</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="determine_functional_form.html#cb33-1" aria-hidden="true" tabindex="-1"></a>f_cut <span class="ot">&lt;-</span> <span class="cf">function</span>(cut) {</span>
<span id="cb33-2"><a href="determine_functional_form.html#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">case_when</span>(</span>
<span id="cb33-3"><a href="determine_functional_form.html#cb33-3" aria-hidden="true" tabindex="-1"></a>    cut <span class="sc">==</span> <span class="st">&quot;Fair&quot;</span>      <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb33-4"><a href="determine_functional_form.html#cb33-4" aria-hidden="true" tabindex="-1"></a>    cut <span class="sc">==</span> <span class="st">&quot;Good&quot;</span>      <span class="sc">~</span> a_cut_Good,</span>
<span id="cb33-5"><a href="determine_functional_form.html#cb33-5" aria-hidden="true" tabindex="-1"></a>    cut <span class="sc">==</span> <span class="st">&quot;Very Good&quot;</span> <span class="sc">~</span> a_cut_Very_Good,</span>
<span id="cb33-6"><a href="determine_functional_form.html#cb33-6" aria-hidden="true" tabindex="-1"></a>    cut <span class="sc">==</span> <span class="st">&quot;Premium&quot;</span>   <span class="sc">~</span> a_cut_Premium,</span>
<span id="cb33-7"><a href="determine_functional_form.html#cb33-7" aria-hidden="true" tabindex="-1"></a>    cut <span class="sc">==</span> <span class="st">&quot;Ideal&quot;</span>     <span class="sc">~</span> a_cut_Ideal</span>
<span id="cb33-8"><a href="determine_functional_form.html#cb33-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-9"><a href="determine_functional_form.html#cb33-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Note that the constant for Fair is 0. Fair is the worst quality cut and the lowest factor level of <code>cut</code>. By convention, the lowest factor level’s constant is added to <code>a_0</code>, so we don’t need a <code>a_cut_Fair</code>. The rest of the constants are then created relative to this lowest value.</p>
<p>In formula syntax, this functional form is</p>
<p><code>log(price) ~ log(carat) + cut</code></p>
<p>In the next section, we’ll visualize <code>clarity</code> and <code>color</code> and discuss visualizing discrete predictors in more detail.</p>
</div>
<div id="visual-checks-1" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Visual checks<a href="determine_functional_form.html#visual-checks-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that you understand the form of <code>f_cut()</code>, we can be more precise about what to look for when visualizing a potential discrete predictor. Assume you created a visualization like we did above, with a continuous predictor on the x-axis, the response on the y-axis, and a smooth line for each value of the potential discrete predictor. Here’s a set of characteristics to check for:</p>
<ul>
<li><p>The smooth lines should all be approximately linear.</p>
<p>For a linear function to approximate the relationship well, each of the smooth
lines needs to be linear.</p></li>
<li><p>The smooth lines should all be approximately parallel to each other.</p>
<p>In our example, the slopes of the lines depend only on our continuous predictor: <code>log(carat)</code>. Changing <code>cut</code> does not change the slope. Non-parallel smooth lines suggest that slope depends on both the continuous predictor and the discrete predictor. This is called an <em>interaction</em>. Interactions aren’t part of the set of function families we’re looking at in this chapter, so we won’t talk more about them here.</p></li>
<li><p>The smooth lines should have different intercepts.</p>
<p>Smooth lines that are stacked on top of each other and don’t have different intercepts suggest that the discrete variable doesn’t influence the response.</p></li>
</ul>
<p><code>cut</code> met all three of our criteria pretty well, although the Premium and Very Good smooth lines are very close together.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="determine_functional_form.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_smooth</span>(cut)</span></code></pre></div>
<p><img src="determine_functional_form_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>This overlap suggests that there isn’t much of a price difference between Very Good and Premium diamonds.</p>
<p>Next, let’s look at <code>clarity</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="determine_functional_form.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_smooth</span>(clarity)</span></code></pre></div>
<p><img src="determine_functional_form_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><code>clarity</code> also mostly meets our criteria, although two of the levels (VVS1 and VVS2) are again very close together.</p>
<p>The slope of the line for I1 also looks a bit different than the rest. However, only 1.28% of diamonds are I1, so it will be okay if our linear model doesn’t approximate them as well as other diamonds.</p>
<p>Finally, we’ll look at <code>color</code>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="determine_functional_form.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_smooth</span>(color)</span></code></pre></div>
<p><img src="determine_functional_form_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><code>color</code> also meets all three of our criteria pretty well. Again, some of the smooth lines (D, E, F, and G) are almost entirely on top of each other, suggesting that increasing quality above G does not influence price very much. We could try combining D, E, F, and G into one level.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="determine_functional_form.html#cb37-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="determine_functional_form.html#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_combined =</span> <span class="fu">fct_collapse</span>(color, <span class="at">DEFG =</span> <span class="fu">c</span>(<span class="st">&quot;D&quot;</span>, <span class="st">&quot;E&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;G&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="determine_functional_form.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_smooth</span>(color_combined, <span class="at">data =</span> .)</span></code></pre></div>
<p><img src="determine_functional_form_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The smooth lines are now more clearly separated. Later, when we fit our models, we’ll compare models that combine nearby factor levels to models that use all the original values.</p>
<p>The separation between the smooth lines varies between <code>clarity</code>, <code>cut</code>, and <code>color</code>. The larger the separation between smooth lines, the more that variable influences <code>price</code>. So <code>clarity</code> likely influences <code>price</code> the most, followed by <code>color</code>, then <code>cut</code>.</p>
</div>
</div>
<div id="summary-3" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Summary<a href="determine_functional_form.html#summary-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>From our EDA, we now know that:</p>
<ul>
<li>We need to log-transform both <code>price</code> and <code>carat</code> to make the relationship linear.</li>
<li><code>clarity</code>, <code>color</code>, and <code>cut</code> all influence <code>price</code>, and we can add any of them to our model.</li>
<li><code>clarity</code> is the most important of the three discrete Cs, followed by <code>color</code>, then <code>cut</code>.</li>
<li>Increasing the quality of the color beyond G doesn’t influence price very much. We could experiment with combining the top levels of <code>color</code> into one level before fitting our model.</li>
</ul>
<p>Even though <code>carat</code>, <code>clarity</code>, <code>color</code>, and <code>cut</code> all influence price, we shouldn’t necessarily add them all into our model. In the next chapter, we’ll explain how to fit a model for a given function family. Then, in the following chapter, we’ll discuss the trade-offs involved in adding additional predictors to models, and we’ll explain how to choose between different models.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Note that we used <code>method = "loess"</code> instead of the default <code>method = "gam"</code>. <code>"loess"</code> can take more time and memory for large amounts of data, but often gives better results. For more information, see <a href="https://dcl-data-vis.stanford.edu/continuous-continuous.html#smoothing" class="uri">https://dcl-data-vis.stanford.edu/continuous-continuous.html#smoothing</a> .<a href="determine_functional_form.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="understand_your_data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="fitting_basics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dcl-docs/model/edit/master/determine_functional_form.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
